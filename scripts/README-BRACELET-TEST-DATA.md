# Генерация тестовых данных браслета

Скрипт для создания тестовых данных браслета, которые проходят через все сервисы системы.

## Назначение

Скрипт `generate-bracelet-test-data.ts` создает разнообразные тестовые данные телеметрии, которые позволяют проверить работу всех сервисов:

- **Telemetry Service** - сохранение данных телеметрии
- **AI Prediction Service** - анализ данных и генерация предсказаний
- **Alert Service** - проверка критических метрик и создание алертов
- **Location Service** - обработка данных о местоположении
- **Analytics Service** - агрегация и анализ данных

## Запуск

```bash
npm run test:bracelet-data
```

## Что создается

### 1. Тестовые сценарии (8 сценариев)

#### Сценарий 1: Нормальные показатели
- Базовый сценарий с нормальными показателями здоровья
- Все метрики в пределах нормы

#### Сценарий 2: Критический пульс
- Высокий пульс (120 bpm) - требует внимания
- Ожидается алерт: `high_heart_rate`
- Ожидается обработка AI-prediction-service

#### Сценарий 3: Низкое SpO2
- Критически низкое насыщение кислородом (88%)
- Ожидается алерт: `low_spo2`
- Ожидается обработка AI-prediction-service

#### Сценарий 4: Обнаружение падения
- Экстренная ситуация - обнаружено падение
- Ожидается алерт: `fall_detected`
- Ожидается обработка AI-prediction-service

#### Сценарий 5: Высокая температура
- Лихорадка - повышенная температура (38.5°C)
- Ожидается алерт: `high_temperature`
- Ожидается обработка AI-prediction-service

#### Сценарий 6: Низкая батарея
- Предупреждение о низком заряде (15%)
- Ожидается алерт: `low_battery`

#### Сценарий 7: Низкая активность
- Мало шагов (50) - возможная проблема
- Ожидается обработка AI-prediction-service

#### Сценарий 8: Комплексная аномалия
- Несколько проблем одновременно:
  - Высокий пульс (130 bpm)
  - Низкое SpO2 (90%)
  - Высокая температура (38.8°C)
  - Низкая батарея (25%)
- Ожидаются алерты: `high_heart_rate`, `low_spo2`, `high_temperature`, `low_battery`
- Ожидается обработка AI-prediction-service

### 2. Временной ряд (последние 24 часа)

Генерируются данные за последние 24 часа с интервалом 15 минут:
- Нормальные показатели с вариациями
- Учет времени суток (день/ночь)
- Реалистичные изменения метрик

## Структура данных

Каждая запись содержит:
- `device_id` - ID устройства (из seed)
- `ward_id` - ID подопечного (из seed)
- `metric_type` - тип метрики (heart_rate, spo2, temperature, steps, battery, fall_detected)
- `value` - значение метрики
- `unit` - единица измерения
- `quality_score` - оценка качества данных (0.0-1.0)
- `timestamp` - временная метка
- `location` - координаты (для некоторых сценариев)

## Метрики

### Поддерживаемые типы метрик:

- **heart_rate** - Пульс (bpm)
- **spo2** - Насыщение кислородом (%)
- **temperature** - Температура тела (°C)
- **steps** - Количество шагов (count)
- **battery** - Уровень заряда батареи (%)
- **fall_detected** - Обнаружение падения (1 = обнаружено)

## Проверка данных

После генерации данных можно проверить их через API:

### Получить последние данные:
```bash
GET /api/v1/telemetry/wards/{wardId}/latest
```

### Получить историю:
```bash
GET /api/v1/telemetry/wards/{wardId}?from={timestamp}&to={timestamp}
```

## Требования

1. Выполнен `npm run db:seed` (созданы тестовые пользователи и устройство)
2. Запущены все необходимые сервисы:
   - Telemetry Service
   - AI Prediction Service
   - Alert Service
   - Location Service
   - Analytics Service
3. Настроен RabbitMQ для обработки событий

## Примечания

- Данные сохраняются напрямую в базу данных `telemetry_db`
- Для полной обработки через все сервисы необходимо, чтобы сервисы были запущены и слушали события RabbitMQ
- Скрипт использует тестовое устройство из seed (`bracelet-demo-api-key`)
- Подопечный определяется автоматически по привязке устройства

## Пример использования

```bash
# 1. Запустить seed (если еще не запущен)
npm run db:seed

# 2. Запустить генерацию тестовых данных
npm run test:bracelet-data

# 3. Проверить данные через API или фронтенд
# Откройте кабинет опекуна и посмотрите данные подопечного
```

## Логи

Скрипт выводит подробную информацию о каждом сценарии:
- Название и описание сценария
- Временная метка
- Местоположение (если есть)
- Все метрики с значениями
- Ожидаемые алерты
- Ожидаемая обработка AI-prediction-service

В конце выводится общая статистика:
- Количество созданных записей
- ID устройства и подопечного
- Инструкции по проверке данных

