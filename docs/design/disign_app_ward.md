# Design: Ward App

## Технологический стек

Код: `mobile/ward-app/` (React Native + TypeScript)

**Основные технологии:**
- React Native 0.72.6 для кроссплатформенной разработки
- TypeScript для типобезопасности
- Redux Toolkit для state management (`src/store/slices/*`)
- React Navigation для навигации (Stack + Bottom Tabs)
- React Native BLE PLX для работы с Bluetooth Low Energy устройствами
- React Native Geolocation для отслеживания местоположения
- React Native Push Notifications для push-уведомлений
- Axios для HTTP запросов

## Дизайн-система

### Цветовая палитра

**Светлая тема (Light Mode):**
- Фон приложения: `#F2F4F7` (светло-серый)
- Поверхности: `#FFFFFF` (белый)
- Primary: `#2B7FFF` (синий)
- Primary Dark: `#103B8C` (темно-синий)
- Secondary: `#0C1B33` (почти черный)
- Accent: `#FF6B6B` (красный для SOS)
- Success: `#1DBA73` (зеленый)
- Warning: `#F4A100` (оранжевый)
- Info: `#2EC5F6` (голубой)
- Danger: `#F04438` (красный)
- Текст: `#0F172A` (темно-серый)
- Текст вторичный: `#475467` (серый)
- Разделители: `#E4E7EC` (светло-серый)

**Темная тема для Guardian режима:**
- Фон: `#101828` (темно-серый)

### Типографика

- Hero: `34px` (заголовки экранов)
- Title: `24px` (заголовки секций)
- Subtitle: `18px` (подзаголовки)
- Body: `16px` (основной текст)
- Caption: `14px` (вторичный текст)
- Tiny: `12px` (мелкий текст)

### Spacing (отступы)

- xs: `4px`
- sm: `8px`
- md: `16px`
- lg: `24px`
- xl: `32px`

### Радиусы скругления

- sm: `8px`
- md: `16px`
- lg: `28px`
- circle: `999px` (полный круг)

### Тени

- Soft: мягкая тень для карточек
- Card: тень для карточек метрик

### Статусная палитра

- Safe: `#1DBA73` (зеленый) — стабильное состояние
- Caution: `#FFB020` (желтый) — требует внимания
- Alert: `#F04438` (красный) — критичное состояние

## Структура экранов

### 1. Login Screen (Авторизация)

**Путь:** `/login`

**Функциональность:**
- Вход по email/паролю
- Сохранение токенов в SecureStore
- Автоматическое обновление токенов
- Проверка авторизации при запуске приложения

**UI элементы:**
- Поля ввода email и пароля
- Кнопка входа
- Переключение между Ward и Guardian режимами

### 2. Dashboard Screen (Дашборд подопечного)

**Путь:** `/dashboard` (Ward режим)

**Компоненты:**
- Метрики здоровья в реальном времени:
  - Пульс (heart_rate) — пороги: safe [55-95], caution [95-110]
  - Температура (temperature) — пороги: safe [35.8-37.2], caution [37.2-38]
  - Активность (steps) — пороги: safe [4000-10000], caution [2000-3999]
- Статус подключенного устройства (BLE)
- Кнопка SOS (экстренный вызов)
- Быстрый доступ к истории телеметрии

**Особенности:**
- Автоматическое подключение к BLE устройствам
- Real-time обновление метрик
- Цветовая индикация статуса (safe/caution/alert)
- Отображение "Нет данных" при отсутствии подключения

### 3. Guardian Dashboard Screen (Дашборд опекуна)

**Путь:** `/guardian-dashboard` (Guardian режим)

**Компоненты:**
- Список подопечных с краткой информацией
- Статусы подопечных (онлайн/офлайн, последняя активность)
- Быстрый доступ к деталям подопечного
- Кнопка добавления нового подопечного

### 4. Guardian Wards Screen (Список подопечных)

**Путь:** `/wards` (Guardian режим)

**Функциональность:**
- Полный список всех подопечных
- Фильтрация и поиск
- Статусы подопечных
- Переход к детальной информации

### 5. Guardian Ward Detail Screen (Детали подопечного)

**Путь:** `/ward-detail/:id` (Guardian режим)

**Компоненты:**
- Текущие показатели здоровья подопечного
- Графики телеметрии (история)
- Список алертов подопечного
- Привязанные устройства
- Информация о местоположении

### 6. Create Ward Screen (Создание подопечного)

**Путь:** `/create-ward` (Guardian режим)

**Функциональность:**
- Форма создания нового подопечного
- Загрузка аватара
- Привязка устройств
- Настройка параметров мониторинга

### 7. SOS Screen (Экстренный вызов)

**Путь:** `/sos`

**Функциональность:**
- Большая кнопка SOS для экстренного вызова
- Автоматическая отправка местоположения
- Виброотклик при нажатии
- Создание критичного события в системе
- Отмена вызова (если нажато случайно)

**UI особенности:**
- Яркий красный цвет (#FF6B6B)
- Крупная кнопка для быстрого доступа
- Анимация при нажатии

### 8. Alerts Screen (Алерты)

**Путь:** `/alerts`

**Компоненты:**
- Список всех алертов
- Фильтрация по серьезности (critical, warning, info)
- Отметка как прочитанных
- Pull-to-refresh для обновления
- Детальная информация об алерте

### 9. Settings Screen (Настройки)

**Путь:** `/settings`

**Функциональность:**
- Профиль пользователя
- Настройки уведомлений
- Управление устройствами
- Выход из аккаунта

### 10. Telemetry History Screen (История телеметрии)

**Путь:** `/telemetry-history`

**Компоненты:**
- Графики истории телеметрии
- Фильтрация по датам
- Экспорт в CSV
- Детальный просмотр записей

### 11. Incoming Call Screen (Входящий вызов)

**Путь:** `/incoming-call` (модальный экран)

**Функциональность:**
- Отображение входящего вызова от диспетчера
- Кнопки принятия/отклонения
- Информация о диспетчере
- Полноэкранный модальный режим

## Навигация

### Ward режим (Bottom Tabs)

- Dashboard (главный экран)
- Alerts (алерты)
- SOS (экстренный вызов)
- Settings (настройки)

### Guardian режим (Bottom Tabs)

- Dashboard (дашборд опекуна)
- Wards (список подопечных)
- Alerts (алерты)
- Settings (настройки)

### Stack навигация

- Login/Register экраны
- Детальные экраны (Ward Detail, Telemetry History)
- Модальные экраны (Incoming Call, Create Ward)

## Архитектура состояния

**Redux Slices:**
- `authSlice` — аутентификация, пользователь, токены
- `deviceSlice` — управление BLE устройствами, подключение
- `telemetrySlice` — телеметрия (HR, температура, шаги)
- `locationSlice` — геолокация, отслеживание местоположения
- `alertSlice` — алерты, уведомления

**Сервисы:**
- `ApiClient.ts` — HTTP клиент с автоматическим добавлением токенов
- `AuthService.ts` — аутентификация, управление токенами
- `DeviceService.ts` — работа с устройствами через API
- `TelemetryService.ts` — отправка/получение телеметрии
- `AlertService.ts` — работа с алертами
- `BluetoothService.ts` — BLE подключение и чтение данных
- `LocationService.ts` — геолокация через нативные API
- `ApiLocationService.ts` — отправка местоположения на сервер
- `NotificationService.ts` — push-уведомления

## Offline режим

**Offline Buffer:**
- Сохранение телеметрии в локальное хранилище при отсутствии сети
- Автоматическая отправка при восстановлении соединения
- Retry механизм с экспоненциальной задержкой
- Индикация статуса подключения

**Локальное хранилище:**
- AsyncStorage для данных приложения
- SecureStore для токенов и чувствительных данных

## Интеграции

**Bluetooth Low Energy (BLE):**
- Автоматическое сканирование и подключение к устройствам
- Чтение данных о здоровье (пульс, температура, активность)
- Управление подключением (connect/disconnect)

**Геолокация:**
- Фоновое отслеживание местоположения
- Отправка координат на сервер
- Использование для экстренных вызовов

**Push-уведомления:**
- Уведомления о критичных алертах
- Входящие вызовы от диспетчеров
- Напоминания и важные события

## UX паттерны

### Доступность

- Крупные кнопки для удобного нажатия
- Контрастные цвета для статусов
- Визуальная обратная связь (вибрация, анимации)
- Поддержка крупного шрифта системы

### Производительность

- Оптимистичные обновления UI
- Ленивая загрузка экранов
- Кэширование данных
- Оптимизация рендеринга списков

### Безопасность

- SecureStore для токенов
- Шифрование чувствительных данных
- Автоматический logout при истечении токена
- Защита от несанкционированного доступа
