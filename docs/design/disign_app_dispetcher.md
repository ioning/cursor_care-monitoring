# Design: Dispatcher App

## Технологический стек

Код: `frontend/apps/dispatcher-app/` (Vue 3 + Vite + TypeScript)

**Основные технологии:**
- Vue 3 с Composition API
- TypeScript для типобезопасности
- Pinia для state management (`src/stores/*`)
- Vue Router для навигации
- Axios для HTTP запросов
- Leaflet для карт и геолокации
- date-fns для работы с датами
- Vite для сборки

## Дизайн-система

### Цветовая палитра

**Emergency/Dispatcher Theme (темная тема):**
- Primary: `#ef4444` (красный — экстренный)
- Primary Dark: `#dc2626` (темно-красный)
- Primary Light: `#f87171` (светло-красный)
- Secondary: `#1f2937` (темно-серый)
- Accent: `#f59e0b` (оранжевый)

**Статусные цвета:**
- Success: `#10b981` (зеленый)
- Success Dark: `#059669`
- Warning: `#f59e0b` (оранжевый)
- Warning Dark: `#d97706`
- Danger: `#ef4444` (красный)
- Danger Dark: `#dc2626`
- Info: `#3b82f6` (синий)
- Info Dark: `#2563eb`

**Фоны (темная тема):**
- Primary: `#0a0e1a` (почти черный)
- Secondary: `#1a1f2e` (темно-серый)
- Tertiary: `#252b3d` (серо-синий)
- Card: `#1a1f2e`
- Card Hover: `#252b3d`
- Overlay: `rgba(10, 14, 26, 0.9)`

**Текст:**
- Primary: `#f8fafc` (почти белый)
- Secondary: `#cbd5e1` (светло-серый)
- Tertiary: `#94a3b8` (серый)
- Muted: `#64748b` (темно-серый)

**Границы:**
- Border: `#334155`
- Border Hover: `#475569`

### Тени и эффекты

- Shadow: стандартная тень с усиленным контрастом
- Shadow LG: крупная тень для модальных окон
- Shadow Glow: свечение красным цветом
- Shadow Glow Primary: усиленное свечение для критичных элементов

### Градиенты

- Primary Gradient: `linear-gradient(135deg, #ef4444 0%, #f59e0b 50%, #dc2626 100%)`
- Card Gradient: `linear-gradient(135deg, #1a1f2e 0%, #252b3d 100%)`
- Emergency Gradient: `linear-gradient(135deg, #dc2626 0%, #991b1b 100%)`

### Типографика

- Шрифт: `-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif`
- Font smoothing: antialiased
- Line height: `1.6`

### Фоновые эффекты

- Радиальные градиенты для создания атмосферы экстренности:
  - `radial-gradient(at 0% 0%, rgba(239, 68, 68, 0.15) 0px, transparent 50%)`
  - `radial-gradient(at 100% 100%, rgba(245, 158, 11, 0.1) 0px, transparent 50%)`

## Структура экранов

### 1. Login View (Авторизация)

**Путь:** `/login`

**Компоненты:**
- Форма входа (email/пароль)
- Кнопка входа с градиентным фоном (красный/оранжевый)
- Обработка ошибок авторизации

**UI особенности:**
- Emergency тема с красными акцентами
- Анимация загрузки
- Валидация полей

### 2. Dashboard View (Главная панель управления)

**Путь:** `/dashboard`

**Компоненты:**
- **Статистика вызовов:**
  - Всего вызовов (с трендом новых)
  - Критичные вызовы (требуют немедленного внимания)
  - Активные вызовы (в работе)
  - Завершенные вызовы (сегодня)
  - Высокий приоритет
  - Назначенные вызовы
- **Критичные вызовы:**
  - Список критичных вызовов с приоритетом
  - Быстрые действия (принять вызов)
  - Переход к деталям вызова
- **Активные вызовы:**
  - Список вызовов в работе
  - Статусы вызовов
  - Прогресс выполнения
- **Состояние SMP (Служба Медицинской Помощи):**
  - Доступность бригад
  - Статус интеграции
  - Время отклика

**Особенности:**
- Real-time обновления через WebSocket
- Автоматическое обновление каждые N секунд
- Кнопка ручного обновления
- Цветовая индикация приоритетов

### 3. Calls View (Список всех вызовов)

**Путь:** `/calls`

**Компоненты:**
- Список всех вызовов с пагинацией
- Фильтрация по:
  - Статусу (created, assigned, in_progress, resolved, cancelled)
  - Приоритету (critical, high, medium, low)
  - Дате создания
  - Подопечному
- Сортировка по различным параметрам
- Карточки вызовов с:
  - ID вызова
  - Приоритетом (бейдж)
  - Статусом
  - Информацией о подопечном
  - Типом алерта
  - Временем создания
  - Быстрыми действиями

**Функциональность:**
- Поиск по ID, имени подопечного
- Массовые операции (планируется)
- Экспорт списка вызовов
- Переход к деталям вызова

### 4. Call Detail View (Детальная информация о вызове)

**Путь:** `/calls/:id`

**Компоненты:**
- **Заголовок:**
  - ID вызова
  - Приоритет (бейдж)
  - Статус
  - Время создания
  - Действия (принять, начать, завершить)
- **Информация о подопечном:**
  - Имя и ID
  - Контакты для экстренной связи
  - Дополнительная информация
- **Медицинские данные:**
  - Тип алерта
  - Оценка риска (risk score)
  - Уверенность AI (confidence)
  - Текущие показатели здоровья:
    - Пульс
    - Температура
    - Другие метрики
- **AI анализ:**
  - Предсказание AI
  - Рекомендации
  - Объяснение решения
- **История вызова:**
  - Таймлайн событий
  - Действия диспетчера
  - Изменения статуса
  - Заметки
- **Местоположение:**
  - Карта с маркером
  - Адрес
  - Координаты
- **Заметки:**
  - Добавление заметок
  - История заметок
  - Прикрепление файлов (планируется)

**Функциональность:**
- Принятие вызова (assign)
- Начало работы над вызовом (start)
- Завершение вызова (resolve) с результатом
- Отмена вызова (cancel)
- Добавление заметок
- Просмотр истории

### 5. Map View (Карта с геолокацией)

**Путь:** `/map`

**Компоненты:**
- **Карта (Leaflet):**
  - Маркеры вызовов на карте
  - Цветовая индикация по приоритету:
    - Красный — critical
    - Оранжевый — high
    - Желтый — medium
    - Синий — low
  - Информационные окна (popups) с краткой информацией
  - Кластеризация маркеров при масштабировании
- **Фильтры:**
  - По статусу вызовов
  - По приоритету
  - По времени создания
- **Легенда:**
  - Объяснение цветов маркеров
  - Статистика на карте
- **Управление картой:**
  - Масштабирование
  - Центрирование на вызове
  - Переключение слоев карты

**Функциональность:**
- Клик по маркеру — переход к деталям вызова
- Построение маршрутов (планируется)
- Отображение бригад SMP на карте (планируется)
- История перемещений подопечного (планируется)

**Компонент:** `WardsLocationMap.vue`

## SMP Flows (Процессы работы с Службой Медицинской Помощи)

**Документация:** `docs/dispatcher/*.md`

**Основные процессы:**
1. **Создание вызова SMP:**
   - Автоматическое создание при критичном алерте
   - Ручное создание диспетчером
   - Передача данных о подопечном
2. **Назначение бригады:**
   - Выбор доступной бригады
   - Назначение на вызов
   - Уведомление бригады
3. **Отслеживание выполнения:**
   - Статусы бригады (выехала, на месте, завершена)
   - Обновление в реальном времени
   - Интеграция с системой SMP
4. **Завершение вызова:**
   - Результат работы бригады
   - Медицинские данные
   - Закрытие вызова

## Архитектура состояния

**Pinia Stores:**
- `auth` — аутентификация, пользователь, токены
- `calls` — управление вызовами, список, детали, фильтрация

**API клиенты:**
- Централизованный клиент (`src/api/client.ts`)
- Автоматическое добавление токенов
- Обработка ошибок
- Real-time hooks для WebSocket

**Realtime:**
- WebSocket подключение
- Каналы для обновлений:
  - Новые вызовы
  - Изменения статусов вызовов
  - Обновления местоположения
  - Статусы SMP бригад

## Компоненты

### WardsLocationMap

**Назначение:** Отображение местоположений подопечных и вызовов на карте

**Функциональность:**
- Интеграция с Leaflet
- Маркеры вызовов с цветовой индикацией
- Информационные окна
- Фильтрация маркеров
- Кластеризация при масштабировании

## UX паттерны

### Навигация

- **Top Navigation Bar:** верхняя панель с градиентным фоном (красный/оранжевый)
- **Nav Links:** ссылки на основные разделы (Панель, Вызовы, Карта)
- **User Menu:** информация о пользователе и выход

### Интерактивность

- **Real-time обновления:** автоматическое обновление через WebSocket
- **Оптимистичные обновления:** UI обновляется сразу
- **Loading states:** индикаторы загрузки для всех операций

### Обратная связь

- **Toast уведомления:** для успешных операций и ошибок
- **Статусные бейджи:** цветовые индикаторы приоритетов и статусов
- **Анимации:** плавные переходы, hover эффекты
- **Звуковые уведомления:** для критичных вызовов (планируется)

### Адаптивность

- **Responsive design:** адаптация под разные размеры экранов
- **Mobile support:** оптимизация для планшетов
- **Touch-friendly:** крупные кнопки для быстрых действий

## Особенности

- **Emergency тема:** красные акценты для создания атмосферы экстренности
- **Приоритизация:** четкая визуальная иерархия по приоритетам
- **Быстрые действия:** минимизация кликов для критичных операций
- **Real-time синхронизация:** мгновенные обновления статусов
- **Интеграция с SMP:** автоматическая работа с внешними системами
- **Картографическая визуализация:** наглядное отображение вызовов на карте

## Переменные окружения

```env
VITE_API_URL=http://localhost:3000/api/v1
VITE_WS_URL=ws://localhost:3000/ws
```

## Горячие клавиши (планируется)

- `Ctrl+K` — быстрый поиск вызовов
- `Ctrl+N` — новый вызов
- `Esc` — закрыть модальное окно
- `F5` — обновить данные
