# Процесс разработки

Руководство по процессу разработки и workflow команды.

## Git Workflow

### Ветвление

- `main` - production-ready код
- `develop` - разработка следующей версии
- `feature/*` - новые функции
- `fix/*` - исправления багов
- `hotfix/*` - срочные исправления для production

### Процесс работы с задачей

1. **Создание ветки**
```bash
git checkout develop
git pull origin develop
git checkout -b feature/telemetry-improvements
```

2. **Разработка**
- Делайте коммиты часто с понятными сообщениями
- Следуйте conventional commits: `feat:`, `fix:`, `docs:`, `refactor:`, `test:`

3. **Тестирование**
```bash
npm run test:unit
npm run test:integration
npm run lint
```

4. **Создание Pull Request**
- Опишите изменения
- Укажите связанные issues
- Попросите review у коллег

5. **Code Review**
- Минимум 1 approval для merge
- Все CI проверки должны пройти

6. **Merge в develop**
- После approval и прохождения CI
- Используется squash merge для чистоты истории

## Стандарты кода

### TypeScript

- Строгая типизация (no `any` без веской причины)
- Использование интерфейсов для контрактов
- Документация JSDoc для публичных методов

### NestJS

- Следование DDD принципам
- Разделение на domain/application/infrastructure
- Использование dependency injection

### Vue.js

- Composition API
- TypeScript для всех компонентов
- Использование composables для переиспользуемой логики

## Тестирование

### Unit тесты

- Покрытие доменной логики: 90%+
- Покрытие сервисов: 80%+
- Использование моков для внешних зависимостей

### Integration тесты

- Тестирование API endpoints
- Тестирование взаимодействия с БД
- Тестирование событий RabbitMQ

### E2E тесты

- Критические пользовательские сценарии
- Автоматизация через Playwright/Cypress

## Code Review Checklist

### Функциональность
- [ ] Код решает поставленную задачу
- [ ] Нет неиспользуемого кода
- [ ] Обработаны edge cases
- [ ] Нет хардкода

### Качество кода
- [ ] Код читаемый и понятный
- [ ] Следует принципам SOLID
- [ ] Нет дублирования кода
- [ ] Правильная обработка ошибок

### Тестирование
- [ ] Есть unit тесты
- [ ] Есть integration тесты (если нужно)
- [ ] Все тесты проходят
- [ ] Покрытие кода достаточное

### Безопасность
- [ ] Нет утечек секретов
- [ ] Валидация входных данных
- [ ] Правильная авторизация
- [ ] Защита от SQL injection

### Документация
- [ ] Обновлена документация API (если нужно)
- [ ] Добавлены комментарии для сложной логики
- [ ] Обновлен CHANGELOG (если нужно)

## Работа с зависимостями

### Обновление зависимостей

```bash
# Проверка устаревших пакетов
npm outdated

# Обновление patch версий
npm update

# Обновление minor версий (осторожно!)
npm update --save-dev

# Проверка безопасности
npm audit
npm audit fix
```

### Добавление новых зависимостей

1. Проверьте альтернативы
2. Изучите документацию
3. Проверьте лицензию
4. Добавьте в соответствующий package.json
5. Обновите lock файл

## Работа с БД

### Миграции

```bash
# Создание миграции
npm run db:migrate:create -- --name=add-user-preferences

# Применение миграций
npm run db:migrate

# Откат миграции
npm run db:migrate:rollback
```

### Правила миграций

- Миграции должны быть обратимыми
- Не удаляйте старые миграции
- Тестируйте миграции на копии production данных
- Используйте транзакции для безопасности

## Работа с событиями

### Добавление нового события

1. Определите структуру события в `docs/events/rabbitmq-events.md`
2. Создайте TypeScript интерфейс в `shared/types/event.types.ts`
3. Обновите producer и consumer
4. Добавьте тесты

### Версионирование событий

- При breaking changes увеличивайте версию
- Поддерживайте обратную совместимость когда возможно
- Документируйте изменения

## Производительность

### Профилирование

```bash
# Node.js profiling
node --prof app.js
node --prof-process isolate-*.log > processed.txt

# Memory profiling
node --inspect app.js
# Открыть chrome://inspect
```

### Оптимизация

- Используйте connection pooling для БД
- Кэшируйте частые запросы
- Оптимизируйте запросы к БД (индексы, EXPLAIN)
- Используйте batch операции где возможно

## Отладка

### Локальная отладка

```bash
# NestJS с debugger
npm run start:debug

# Подключение к процессу
# В VS Code: F5 -> Attach to Process
```

### Логирование

- Используйте структурированное логирование (JSON)
- Уровни: error, warn, info, debug
- Включайте correlationId для трассировки
- Не логируйте секреты и персональные данные

## Работа с секретами

### Никогда не коммитьте

- Пароли
- API ключи
- Приватные ключи
- Токены доступа

### Использование

- `.env` файлы для локальной разработки
- Kubernetes Secrets для production
- HashiCorp Vault для централизованного управления

## Релизный процесс

### Подготовка релиза

1. Обновить версию в package.json
2. Обновить CHANGELOG.md
3. Создать git tag
4. Собрать Docker образы
5. Развернуть в staging
6. Провести smoke tests
7. Развернуть в production

### Версионирование

Используем Semantic Versioning (SemVer):
- `MAJOR` - breaking changes
- `MINOR` - новые функции (обратно совместимые)
- `PATCH` - исправления багов

### Hotfix процесс

1. Создать ветку от `main`
2. Исправить проблему
3. Протестировать
4. Создать PR в `main`
5. После merge создать tag и релиз

## Коммуникация

### Daily Standup

- Что сделано вчера
- Что планируется сегодня
- Есть ли блокеры

### Code Review

- Отвечайте на review запросы в течение 24 часов
- Будьте конструктивны в комментариях
- Объясняйте "почему", а не только "что"

### Документация

- Обновляйте документацию вместе с кодом
- Документируйте решения (ADR - Architecture Decision Records)
- Делитесь знаниями через документацию

