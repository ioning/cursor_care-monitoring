# Мобильное приложение для опекунов

**Дата**: 2024-01-15  
**Версия**: 1.0.0  
**Статус**: ✅ Полностью реализовано

## Обзор

Реализована полная функциональность роли опекуна в мобильном приложении со всем функционалом веб-приложения, включая возможность загрузки фото аватара подопечного.

## Возможности

### Для опекунов

1. **Список подопечных**
   - Отображение всех подопечных опекуна
   - Аватары подопечных (или инициалы)
   - Информация о возрасте и поле
   - Медицинские бейджи
   - Удаление подопечных

2. **Детали подопечного**
   - Полная информация о подопечном
   - Загрузка/изменение аватара
   - Медицинская информация
   - Контактная информация
   - Быстрый доступ к показателям, алертам и геолокации

3. **Загрузка аватара**
   - Выбор фото из галереи
   - Автоматическая загрузка на сервер
   - Отображение загруженного аватара
   - Индикация процесса загрузки

## Архитектура

### Backend

**Миграция БД:**
- Добавлено поле `avatar_url` в таблицу `wards`
- Индекс для оптимизации запросов

**API Endpoint:**
- `POST /users/wards/:wardId/avatar` - Загрузка аватара
  - Использует `multer` для обработки файлов
  - Валидация типа файла (только изображения)
  - Ограничение размера (5MB)
  - Сохранение в `uploads/avatars/`
  - Возвращает URL загруженного файла

**Сервисы:**
- `WardService.updateAvatar()` - Обновление URL аватара в БД
- Автоматическое создание директории для загрузок
- Статическая раздача файлов через `/uploads/`

### Frontend (Mobile)

**Сервисы:**
- `WardService` - API клиент для работы с подопечными
  - `getWards()` - Получение списка
  - `getWard()` - Получение деталей
  - `createWard()` - Создание
  - `updateWard()` - Обновление
  - `deleteWard()` - Удаление
  - `uploadAvatar()` - Загрузка аватара

**Redux Store:**
- `wardSlice` - Управление состоянием подопечных
  - `fetchWards` - Загрузка списка
  - `fetchWard` - Загрузка деталей
  - `createWard` - Создание
  - `updateWard` - Обновление
  - `deleteWard` - Удаление
  - `uploadAvatar` - Загрузка аватара

**Экраны:**
- `GuardianWardsScreen` - Список подопечных
- `GuardianWardDetailScreen` - Детали подопечного с загрузкой аватара

**Навигация:**
- Автоматическое определение роли пользователя
- Разные табы для опекунов и подопечных
- Стек навигации для деталей подопечного

## Использование

### Загрузка аватара

1. Открыть детали подопечного
2. Нажать на аватар (или иконку камеры)
3. Выбрать фото из галереи
4. Дождаться загрузки
5. Аватар автоматически обновится

### Навигация

**Для опекунов:**
- Таб "Подопечные" - список всех подопечных
- Таб "Алерты" - все алерты
- Таб "Настройки" - настройки приложения

**Для подопечных:**
- Таб "Dashboard" - текущие показатели
- Таб "SOS" - экстренный вызов
- Таб "Алерты" - алерты подопечного
- Таб "Настройки" - настройки

## Технические детали

### Загрузка файлов

**Backend:**
- Использует `multer` для обработки multipart/form-data
- Сохранение в файловую систему
- Генерация уникальных имен файлов
- Валидация типа и размера

**Frontend:**
- Использует `react-native-image-picker` для выбора фото
- FormData для отправки файла
- Индикация процесса загрузки

### Безопасность

- JWT аутентификация
- Проверка доступа опекуна к подопечному
- Валидация типа файла
- Ограничение размера файла
- Фильтрация по организации (multi-tenancy)

## Миграции

Применить миграцию для поддержки аватаров:

```bash
npm run db:migrate
```

Или вручную:

```sql
\i database/migrations/user-service/003_add_avatar_url_to_wards.sql
```

## Зависимости

**Backend:**
- `multer` - обработка файлов
- `@types/multer` - типы для TypeScript

**Mobile:**
- `react-native-image-picker` - выбор изображений

## Следующие шаги (опционально)

1. **Оптимизация изображений**
   - Автоматическое изменение размера
   - Сжатие изображений
   - Генерация миниатюр

2. **Хранение в облаке**
   - Интеграция с S3/Cloud Storage
   - CDN для быстрой загрузки

3. **Дополнительные функции**
   - Редактирование подопечного
   - Создание нового подопечного
   - Просмотр телеметрии
   - Просмотр геолокации

---

**Функциональность полностью реализована и готова к использованию!** ✅



**Дата**: 2024-01-15  
**Версия**: 1.0.0  
**Статус**: ✅ Полностью реализовано

## Обзор

Реализована полная функциональность роли опекуна в мобильном приложении со всем функционалом веб-приложения, включая возможность загрузки фото аватара подопечного.

## Возможности

### Для опекунов

1. **Список подопечных**
   - Отображение всех подопечных опекуна
   - Аватары подопечных (или инициалы)
   - Информация о возрасте и поле
   - Медицинские бейджи
   - Удаление подопечных

2. **Детали подопечного**
   - Полная информация о подопечном
   - Загрузка/изменение аватара
   - Медицинская информация
   - Контактная информация
   - Быстрый доступ к показателям, алертам и геолокации

3. **Загрузка аватара**
   - Выбор фото из галереи
   - Автоматическая загрузка на сервер
   - Отображение загруженного аватара
   - Индикация процесса загрузки

## Архитектура

### Backend

**Миграция БД:**
- Добавлено поле `avatar_url` в таблицу `wards`
- Индекс для оптимизации запросов

**API Endpoint:**
- `POST /users/wards/:wardId/avatar` - Загрузка аватара
  - Использует `multer` для обработки файлов
  - Валидация типа файла (только изображения)
  - Ограничение размера (5MB)
  - Сохранение в `uploads/avatars/`
  - Возвращает URL загруженного файла

**Сервисы:**
- `WardService.updateAvatar()` - Обновление URL аватара в БД
- Автоматическое создание директории для загрузок
- Статическая раздача файлов через `/uploads/`

### Frontend (Mobile)

**Сервисы:**
- `WardService` - API клиент для работы с подопечными
  - `getWards()` - Получение списка
  - `getWard()` - Получение деталей
  - `createWard()` - Создание
  - `updateWard()` - Обновление
  - `deleteWard()` - Удаление
  - `uploadAvatar()` - Загрузка аватара

**Redux Store:**
- `wardSlice` - Управление состоянием подопечных
  - `fetchWards` - Загрузка списка
  - `fetchWard` - Загрузка деталей
  - `createWard` - Создание
  - `updateWard` - Обновление
  - `deleteWard` - Удаление
  - `uploadAvatar` - Загрузка аватара

**Экраны:**
- `GuardianWardsScreen` - Список подопечных
- `GuardianWardDetailScreen` - Детали подопечного с загрузкой аватара

**Навигация:**
- Автоматическое определение роли пользователя
- Разные табы для опекунов и подопечных
- Стек навигации для деталей подопечного

## Использование

### Загрузка аватара

1. Открыть детали подопечного
2. Нажать на аватар (или иконку камеры)
3. Выбрать фото из галереи
4. Дождаться загрузки
5. Аватар автоматически обновится

### Навигация

**Для опекунов:**
- Таб "Подопечные" - список всех подопечных
- Таб "Алерты" - все алерты
- Таб "Настройки" - настройки приложения

**Для подопечных:**
- Таб "Dashboard" - текущие показатели
- Таб "SOS" - экстренный вызов
- Таб "Алерты" - алерты подопечного
- Таб "Настройки" - настройки

## Технические детали

### Загрузка файлов

**Backend:**
- Использует `multer` для обработки multipart/form-data
- Сохранение в файловую систему
- Генерация уникальных имен файлов
- Валидация типа и размера

**Frontend:**
- Использует `react-native-image-picker` для выбора фото
- FormData для отправки файла
- Индикация процесса загрузки

### Безопасность

- JWT аутентификация
- Проверка доступа опекуна к подопечному
- Валидация типа файла
- Ограничение размера файла
- Фильтрация по организации (multi-tenancy)

## Миграции

Применить миграцию для поддержки аватаров:

```bash
npm run db:migrate
```

Или вручную:

```sql
\i database/migrations/user-service/003_add_avatar_url_to_wards.sql
```

## Зависимости

**Backend:**
- `multer` - обработка файлов
- `@types/multer` - типы для TypeScript

**Mobile:**
- `react-native-image-picker` - выбор изображений

## Следующие шаги (опционально)

1. **Оптимизация изображений**
   - Автоматическое изменение размера
   - Сжатие изображений
   - Генерация миниатюр

2. **Хранение в облаке**
   - Интеграция с S3/Cloud Storage
   - CDN для быстрой загрузки

3. **Дополнительные функции**
   - Редактирование подопечного
   - Создание нового подопечного
   - Просмотр телеметрии
   - Просмотр геолокации

---

**Функциональность полностью реализована и готова к использованию!** ✅







